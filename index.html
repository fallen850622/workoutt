<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>workoutt</title>

<!-- Favicon / 主畫面圖示 -->
<link rel="icon" type="image/png" href="index.png">
<link rel="apple-touch-icon" href="index.png">
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

<style>
:root {
    --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --accent: #94a3b8;
    --success: #475569; --item-bg: #f1f5f9; --blue-light: #e2e8f0; --danger: #f87171;
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; }

/* Tab Bar */
.tab-bar { position: sticky; top: 0; display: flex; background: var(--card); box-shadow: 0 1px 5px rgba(0,0,0,0.05); z-index: 100; }
.tab-btn { flex: 1; padding: 18px 0; border: none; background: none; font-weight: bold; color: var(--accent); cursor: pointer; border-bottom: 3px solid transparent; font-size: 1rem; transition: 0.3s; }
.tab-btn:hover { color: var(--success); }
.tab-btn.active { color: var(--success); border-bottom-color: var(--success); }

/* Pages */
.page { display: none; padding: 15px; flex-direction: column; align-items: center; width: 100%; }
.page.active { display: flex; }

/* Card */
.card { background: var(--card); border-radius: 24px; padding: 20px; width: 100%; max-width: 500px; box-shadow: 0 8px 24px rgba(0,0,0,0.08); margin-bottom: 20px; transition: transform 0.2s; }
.card:hover { transform: translateY(-2px); }

/* Chart Card */
.chart-card { height: 350px; position: relative; border-radius: 24px; padding: 20px; box-shadow: 0 8px 24px rgba(0,0,0,0.08); background: var(--card); margin-bottom:20px; }

/* Stats Input */
.stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; width: 100%; }
.input-group { display: flex; flex-direction: column; align-items: center; }
.input-group label { font-size: 0.75rem; color: var(--accent); margin-bottom: 6px; font-weight: 500; }
.input-group input { border: 1px solid var(--blue-light); border-radius: 12px; padding: 12px 5px; text-align: center; outline: none; width: 100%; font-size: 1.1rem; background: #fff; appearance: none; -moz-appearance: textfield; }
.input-group input::-webkit-outer-spin-button, .input-group input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

/* BMI */
#bmiValue { font-weight: bold; color: #f87171; }

/* Gantt */
.gantt-container { overflow-x: auto; width: 100%; border-radius: 12px; }
.gantt-table { border-collapse: collapse; font-size: 0.75rem; min-width: 700px; }
.gantt-table th, .gantt-table td { border: 1px solid #f1f5f9; padding: 12px 6px; text-align: center; }
.gantt-row-title { text-align: left; background: #fff; font-weight: bold; position: sticky; left: 0; z-index: 2; min-width: 120px; box-shadow: 2px 0 5px rgba(0,0,0,0.03); }
.count-badge { background: #f1f5f9; color: #475569; padding: 2px 6px; border-radius: 6px; font-size: 0.65rem; margin-left: 4px; }
.gantt-cell.active { background: #475569; color: white; font-weight: bold; }

/* Calendar */
.calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; text-align: center; }
.day { padding: 12px 0; border-radius: 12px; font-size: 0.9rem; cursor: pointer; color: #94a3b8; position: relative; transition: 0.3s; }
.day.selected { background: var(--success); color: white; }
.day.has-workout::after { content: ''; position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%); width: 6px; height: 6px; background: #f87171; border-radius: 50%; }
.day:hover { background: #e2e8f0; color: #1e293b; }

/* Workout Items */
.item-wrapper { position: relative; margin-bottom: 12px; border-radius: 18px; border: 1px solid #e2e8f0; background: var(--danger); overflow: hidden; width: 100%; max-width: 450px; }
.training-group { background: var(--card); transition: transform 0.3s ease; position: relative; z-index: 2; }
.group-header { padding: 18px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-weight: bold; }
.group-header.active { background: #475569; color: white; }
.details { padding: 18px; background: var(--f8fafc); font-size: 0.85rem; display: none; border-top: 1px solid #e2e8f0; }
.details.show { display: block; }

/* Add Button */
.btn-add { width: 100%; max-width: 450px; padding: 16px; background: linear-gradient(90deg, #94a3b8, #e2e8f0); border: none; border-radius: 18px; color: white; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition:0.3s; margin-bottom:60px; }
.btn-add:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
</style>
</head>
<body>

<!-- Tab Bar -->
<div class="tab-bar">
    <button class="tab-btn active" onclick="switchPage('daily')">今日紀錄</button>
    <button class="tab-btn" onclick="switchPage('gantt')">運動統計</button>
    <button class="tab-btn" onclick="switchPage('chart')">趨勢圖表</button>
</div>

<!-- 今日紀錄 -->
<div id="daily" class="page active">
    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <button onclick="changeMonth(-1)" style="border:none; background:none; font-size:1.5rem; color:#94a3b8;">‹</button>
            <span id="monthYearDisplay" style="font-weight:bold; font-size:1.1rem;"></span>
            <button onclick="changeMonth(1)" style="border:none; background:none; font-size:1.5rem; color:#94a3b8;">›</button>
        </div>
        <div class="calendar-grid" id="calendarGrid"></div>
    </div>

    <div class="card">
        <div class="stats-grid">
            <div class="input-group">
                <label>身高(cm)</label>
                <input type="text" inputmode="decimal" id="height" placeholder="--" oninput="saveBodyStats()">
            </div>
            <div class="input-group">
                <label>體重(kg)</label>
                <input type="text" inputmode="decimal" id="weight" placeholder="--" oninput="saveBodyStats()">
            </div>
            <div class="input-group">
                <label>體脂(%)</label>
                <input type="text" inputmode="decimal" id="bodyFat" placeholder="--" oninput="saveBodyStats()">
            </div>
        </div>
        <div style="margin-top:10px; font-weight:bold; color:#475569;">
            BMI：<span id="bmiValue">--</span>
        </div>
    </div>

    <div id="selectedDateText" style="margin: 15px 0; font-weight: bold; color: #475569;">日期：載入中...</div>
    <div id="workoutList" style="width: 100%; display: flex; flex-direction: column; align-items: center;"></div>
    <button class="btn-add" onclick="addNewItem()">+ 自定義新增項目</button>
</div>

<!-- 甘特圖 -->
<div id="gantt" class="page">
    <div class="card" style="max-width: 100%; overflow: hidden;">
        <h3 style="text-align: center; margin-top: 0;">本月運動報表</h3>
        <div class="gantt-container" id="ganttBox"></div>
    </div>
</div>

<!-- 趨勢圖表 -->
<div id="chart" class="page">
    <div class="card chart-card"><canvas id="weightChart"></canvas></div>
    <div class="card chart-card"><canvas id="fatChart"></canvas></div>
</div>

<script>
const workoutData = {
    "腹肌訓練":["Dead bug / 慢速登山者","Leg raise combo / 後仰坐姿肩推"],
    "直角肩訓練":["開合跳肩推 / 伏地挺身+側轉體","Walking w / 肩環繞"],
    "背肌訓練":["俯身開背 / 短槓划船","單手划船 / 彈力繩划船"],
    "臀部訓練":["Sumo深蹲 / 螃蟹走路 7趟","深蹲跳 / 後弓箭步"],
    "全身訓練":["側棒夾腿 / 跪膝伏地挺身","弓箭步彎舉 / 深蹲肩推"],
    "平板撐系列":["單手移啞鈴 / 啞鈴抬舉+深蹲跳","墊腳深蹲 / 弓箭步抬腳"],
    "三頭訓練":["啞鈴後舉 / 三頭自體屈伸","深蹲肩前舉 / 波比跳+伏地挺身"],
    "臀部加強++":["抬膝跑+深蹲 20組","螃蟹走來回七趟","Sumo跳+深蹲跳"]
};
let currentViewDate = new Date();
let selectedDateStr = new Date().toLocaleDateString('sv-SE');
let weightChart, fatChart;

function switchPage(pageId) {
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    event.currentTarget.classList.add('active');
    if(pageId==='gantt') renderGantt();
    if(pageId==='chart') setTimeout(renderCharts,100);
}

function saveBodyStats(){
    const h=parseFloat(document.getElementById('height').value);
    const w=parseFloat(document.getElementById('weight').value);
    const f=parseFloat(document.getElementById('bodyFat').value);
    localStorage.setItem('stats_'+selectedDateStr,JSON.stringify({h,w,f}));
    if(h) localStorage.setItem('global_height',h);

    if(h && w){
        const bmi=(w/((h/100)**2)).toFixed(1);
        document.getElementById('bmiValue').innerText=bmi;
    } else {
        document.getElementById('bmiValue').innerText='--';
    }
}

function loadDailyData(dateStr){
    selectedDateStr=dateStr;
    document.getElementById('selectedDateText').innerText=`日期：${dateStr}`;
    const activeItems=JSON.parse(localStorage.getItem('workout_'+dateStr)||'[]');
    const saved=JSON.parse(localStorage.getItem('stats_'+dateStr)||'{}');
    document.getElementById('height').value=saved.h||localStorage.getItem('global_height')||"";
    document.getElementById('weight').value=saved.w||"";
    document.getElementById('bodyFat').value=saved.f||"";

    if(saved.h && saved.w){
        const bmi=(saved.w/((saved.h/100)**2)).toFixed(1);
        document.getElementById('bmiValue').innerText=bmi;
    } else {
        document.getElementById('bmiValue').innerText='--';
    }

    initWorkoutList(activeItems);
}

// --- 其餘原本功能保持不變 ---
// initWorkoutList, toggleWorkout, renderCalendar, changeMonth, renderGantt, renderCharts, addNewItem, deleteItem

window.onload=()=>{
    renderCalendar();
    loadDailyData(selectedDateStr);
};
</script>

</body>
</html>

